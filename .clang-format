# Configuration file for clang-format
# MPU-6050 Kernel Driver Code Style

# Base style (Linux kernel style)
BasedOnStyle: LLVM

# Language settings
Language: Cpp
Standard: C99

# Indentation
IndentWidth: 8
TabWidth: 8
UseTab: Always
IndentCaseLabels: false
IndentGotoLabels: false
IndentPPDirectives: None

# Line length and wrapping
ColumnLimit: 80
BreakBeforeBraces: Linux
AllowShortIfStatementsOnASingleLine: Never
AllowShortLoopsOnASingleLine: false
AllowShortFunctionsOnASingleLine: None
AllowShortBlocksOnASingleLine: false
AllowShortCaseLabelsOnASingleLine: false

# Alignment
AlignAfterOpenBracket: Align
AlignConsecutiveAssignments: false
AlignConsecutiveDeclarations: false
AlignConsecutiveMacros: false
AlignEscapedNewlines: Left
AlignOperands: true
AlignTrailingComments: true

# Spacing
SpaceAfterCStyleCast: false
SpaceAfterLogicalNot: false
SpaceBeforeAssignmentOperators: true
SpaceBeforeParens: ControlStatements
SpaceInEmptyParentheses: false
SpacesBeforeTrailingComments: 1
SpacesInAngles: false
SpacesInCStyleCastParentheses: false
SpacesInContainerLiterals: false
SpacesInParentheses: false
SpacesInSquareBrackets: false

# Breaking
BreakBeforeBinaryOperators: All
BreakBeforeTernaryOperators: true
BreakConstructorInitializers: BeforeColon
BreakStringLiterals: true
ContinuationIndentWidth: 8

# Pointer alignment
PointerAlignment: Right
DerivePointerAlignment: false

# Function parameters
AllowAllParametersOfDeclarationOnNextLine: false
BinPackParameters: false
BinPackArguments: false

# Include sorting
SortIncludes: true
IncludeBlocks: Regroup
IncludeCategories:
  # Linux kernel headers first
  - Regex: '^<linux/'
    Priority: 1
  # Other system headers
  - Regex: '^<'
    Priority: 2
  # Local headers
  - Regex: '^"'
    Priority: 3

# Comments and macros
ReflowComments: true
FixNamespaceComments: false
ForEachMacros:
  - 'list_for_each'
  - 'list_for_each_safe'
  - 'list_for_each_entry'
  - 'list_for_each_entry_safe'
  - 'for_each_possible_cpu'
  - 'for_each_online_cpu'
  - 'for_each_present_cpu'

# Kernel-specific settings
MacroBlockBegin: '^(MODULE_|EXPORT_SYMBOL|DEVICE_ATTR|DRIVER_ATTR)'
MacroBlockEnd: ''

# Penalty settings (fine-tuning for kernel style)
PenaltyBreakAssignment: 200
PenaltyBreakBeforeFirstCallParameter: 100
PenaltyBreakComment: 300
PenaltyBreakFirstLessLess: 120
PenaltyBreakString: 1000
PenaltyExcessCharacter: 1000000
PenaltyReturnTypeOnItsOwnLine: 600

# Disable certain transformations that conflict with kernel style
DisableFormat: false
KeepEmptyLinesAtTheStartOfBlocks: false
MaxEmptyLinesToKeep: 1

# Additional kernel-style preferences
AlwaysBreakAfterReturnType: None
AlwaysBreakBeforeMultilineStrings: false
CompactNamespaces: false
ConstructorInitializerAllOnOneLineOrOnePerLine: false
ConstructorInitializerIndentWidth: 8
Cpp11BracedListStyle: false
ExperimentalAutoDetectBinPacking: false
IndentWrappedFunctionNames: false
KeepEmptyLinesAtTheStartOfBlocks: false
NamespaceIndentation: None
ObjCBlockIndentWidth: 8
ObjCSpaceAfterProperty: true
ObjCSpaceBeforeProtocolList: true
SpaceAfterTemplateKeyword: false
SpaceBeforeCtorInitializerColon: true
SpaceBeforeInheritanceColon: true
SpaceBeforeRangeBasedForLoopColon: true